name: xiaomi-nabu-dualboot-esp
on:
  workflow_call:
    inputs:
      url:
        type: string
        required: true

      uuid:
        type: string

      name:
        type: string
        required: true
        default: 'esp'

run-name: Xiaomi Pad 5 ESP

jobs:
  esp:
    runs-on: ubuntu-24.04
    steps:
      - name: Setup
        run: sudo apt update && sudo apt install -y tree 7zip

      - name: Checkout
        uses: actions/checkout@v4
        with:
          path: dualboot

      - name: Download release.7z
        run: |
          curl -L ${{ inputs.url }} --output release.7z
          7z x -orelease release.7z

      - name: Download rEFInd artifact 
        uses: actions/download-artifact@v4
        with:
          name: rEFInd
          path: refind

      - name: Download Reboot2Android artifact
        uses: actions/download-artifact@v4
        with:
          name: Reboot2Android
          path: reboot2android

      - name: Tree
        run: tree

      - name: Generate ESP
        env:
          CUSTOM_UUID: ${{ inputs.custom_uuid }}
        run: sudo -E bash ./dualboot/devices/xiaomi-nabu/scripts/generate-esp.sh

      - name: Artifact esp.raw
        uses: actions/upload-artifact@v4
        with:
          name: ${{ inputs.name }}
          path: esp.raw
